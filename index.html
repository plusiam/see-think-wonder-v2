<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>See Think Wonder í•™ìŠµì§€ (ì´ë¯¸ì§€ ì²¨ë¶€í˜•)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif;
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #357abd;
            transform: translateY(-1px);
        }
        
        .btn.download {
            background: #28a745;
        }
        
        .btn.download:hover {
            background: #218838;
        }
        
        .btn.image {
            background: #9333ea;
        }
        
        .btn.image:hover {
            background: #7c3aed;
        }
        
        .btn.reset {
            background: #6c757d;
        }
        
        .btn.reset:hover {
            background: #5a6268;
        }
        
        .worksheet {
            width: 100%;
            max-width: 297mm;
            min-height: 190mm;
            margin: 0 auto;
            background: white;
            padding: 12mm;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .title {
            background: #4a90e2;
            color: white;
            padding: 12px;
            border-radius: 12px;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        @media (max-width: 480px) {
            .title {
                font-size: 18px;
                padding: 10px;
                width: 100%;
                text-align: center;
            }
        }
        
        @media (max-width: 360px) {
            .title {
                font-size: 16px;
                padding: 8px;
                letter-spacing: -0.5px;
            }
        }
        
        .student-info {
            display: flex;
            justify-content: flex-end;
            gap: 25px;
            margin-bottom: 15px;
            font-size: 15px;
        }
        
        .info-field {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-field label {
            font-weight: bold;
            min-width: 40px;
        }

        .info-input {
            border: none;
            border-bottom: 2px solid #333;
            background-color: transparent;
            width: 80px;
            font-size: 15px;
            font-family: inherit;
            text-align: center;
            outline: none;
            padding-bottom: 2px;
            transition: border-color 0.2s;
        }

        .info-input:focus {
            border-bottom-color: #4a90e2;
        }
        
        @media (max-width: 768px) {
            .student-info {
                font-size: 14px;
            }
            
            .info-input {
                width: 80px;
            }
        }

        @media (max-width: 480px) {
            .student-info {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .info-field {
                width: 100%;
            }
            
            .info-input {
                flex: 1;
                max-width: none;
            }
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            min-height: 350px;
        }
        
        /* ì´ë¯¸ì§€ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .image-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            min-width: 280px;
        }
        
        .image-header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .image-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .mode-switcher {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: center;
        }
        
        .mode-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .mode-btn.active {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }
        
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ë°˜ì‘í˜• ì²˜ë¦¬ */
        .btn-text-short {
            display: none;
        }
        
        .title-short {
            display: none;
        }
        
        .btn-icon {
            display: inline-block;
            margin-right: 4px;
        }
        
        @media (max-width: 480px) {
            .btn-text-full {
                display: none;
            }
            .btn-text-short {
                display: inline;
            }
            .title-full {
                display: none;
            }
            .title-short {
                display: inline;
            }
        }
        
        @media (max-width: 360px) {
            .btn-text-short {
                display: none;
            }
            .btn-icon {
                margin-right: 0;
                font-size: 18px;
            }
        }
        
        .image-area {
            background: white;
            border: 2px dashed #ccc;
            border-radius: 8px;
            width: 100%;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .image-area.dragover {
            border-color: #4a90e2;
            background: #f0f7ff;
        }
        
        .upload-placeholder {
            text-align: center;
            color: #999;
        }
        
        .upload-placeholder p {
            margin: 10px 0;
            font-size: 14px;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #ccc;
        }
        
        .uploaded-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        #drawingCanvas {
            display: none;
            cursor: crosshair;
            background: white;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .drawing-tools {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .color-palette {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            justify-content: center;
        }
        
        .color-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
        }
        
        .color-btn.active {
            border-color: #333;
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px #333;
        }
        
        .tool-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        
        .tool-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .brush-size {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .size-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #666;
            border: 2px solid #ddd;
            cursor: pointer;
        }
        
        .size-btn.small { width: 12px; height: 12px; }
        .size-btn.medium { width: 16px; height: 16px; }
        .size-btn.large { width: 20px; height: 20px; }
        .size-btn.active { border-color: #4a90e2; }
        
        .camera-controls {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        
        .camera-controls .tool-btn {
            margin: 0 5px;
        }
        
        @media (max-width: 480px) {
            .camera-controls {
                padding: 8px;
            }
            
            .camera-controls .tool-btn {
                margin: 2px;
                font-size: 12px;
                padding: 6px 10px;
            }
        }
        
        #cameraPreview {
            background: #000;
            border-radius: 8px;
        }
        
        .captured-photo {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .caption-input {
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        /* ìš°ì¸¡ ì½˜í…ì¸  ì˜ì—­ */
        .content-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        
        .section.see {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .section.think {
            border-color: #ffc107;
            background: #fffef5;
        }
        
        .section.wonder {
            border-color: #dc3545;
            background: #fff8f8;
        }
        
        .section-header {
            margin-bottom: 12px;
        }
        
        .section-icon {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .section-question {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
            font-style: italic;
        }
        
        .section-question-ko {
            font-size: 14px;
            color: #333;
            margin-bottom: 15px;
        }
        
        .section.see .writing-area:has(.writing-textarea:focus) {
            border-color: #28a745;
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
        }
        
        .section.think .writing-area:has(.writing-textarea:focus) {
            border-color: #ffc107;
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.2);
        }
        
        .section.wonder .writing-area:has(.writing-textarea:focus) {
            border-color: #dc3545;
            box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2);
        }
        
        .writing-area {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            flex: 1;
            min-height: 180px;
            padding: 0;
            text-align: left;
            overflow: hidden;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .section.see .writing-area:focus-within {
            border-color: #28a745;
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
        }
        
        .section.think .writing-area:focus-within {
            border-color: #ffc107;
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.2);
        }
        
        .section.wonder .writing-area:focus-within {
            border-color: #dc3545;
            box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2);
        }
        
        .writing-textarea {
            width: 100%;
            height: 100%;
            min-height: 180px;
            padding: 12px;
            border: none;
            outline: none;
            resize: none;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            background: transparent;
            transition: background-color 0.2s;
        }
        
        .writing-textarea:focus {
            background-color: #f8f9fa;
        }
        
        .writing-textarea::placeholder {
            color: #999;
            font-style: italic;
        }
        
        .footer {
            margin-top: 15px;
            text-align: center;
            font-size: 11px;
            color: #666;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        
        .footer .tip {
            margin-top: 5px;
            font-style: italic;
            color: #999;
        }
        
        /* íŒŒì¼ ì…ë ¥ ìˆ¨ê¸°ê¸° */
        #fileInput {
            display: none;
        }
        
        /* í…œí”Œë¦¿ ì›Œí¬ì‹œíŠ¸ ìŠ¤íƒ€ì¼ */
        .template-worksheet {
            display: none;
            width: 297mm;
            height: 210mm;
            margin: 0 auto;
            background: white;
            padding: 15mm;
            position: relative;
        }
        
        .template-header {
            text-align: center;
            margin-bottom: 10mm;
        }
        
        .template-title {
            background: #4a90e2;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 32px;
            font-weight: bold;
            display: inline-block;
        }
        
        .template-student-info {
            position: absolute;
            top: 15mm;
            right: 15mm;
            display: flex;
            gap: 20px;
        }
        
        .template-info-field {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .template-info-field label {
            font-weight: bold;
        }
        
        .template-info-field .blank {
            display: inline-block;
            width: 100px;
            border-bottom: 2px solid #333;
            margin-left: 5px;
        }
        
        .template-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            height: calc(100% - 80mm);
            margin-top: 20mm;
        }
        
        .template-section {
            border: 2px solid;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .template-section.see {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .template-section.think {
            border-color: #ffc107;
            background: #fffef5;
        }
        
        .template-section.wonder {
            border-color: #dc3545;
            background: #fff8f8;
        }
        
        .template-section-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .template-section-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .template-section-title {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .template-section-question {
            font-size: 16px;
            color: #666;
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .template-section-question-ko {
            font-size: 18px;
            color: #333;
            font-weight: 500;
        }
        
        .template-writing-area {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            flex: 1;
            padding: 20px;
        }
        
        .template-footer {
            position: absolute;
            bottom: 5mm; /* 10mmì—ì„œ 5mmë¡œ ìˆ˜ì •ë¨ */
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        
        /* ì¸ì‡„ ì „ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            @page {
                size: A4 landscape;
                margin: 10mm;
            }
            
            body {
                background: white;
                padding: 0;
                margin: 0;
            }
            
            .controls {
                display: none !important;
            }
            
            .worksheet {
                width: 100%;
                max-width: none;
                height: 100vh;
                min-height: auto;
                margin: 0;
                padding: 10mm;
                box-shadow: none;
                border-radius: 0;
                page-break-inside: avoid;
                page-break-after: avoid;
                page-break-before: avoid;
            }
            
            .main-container {
                display: grid !important;
                grid-template-columns: 250px 1fr !important;
                gap: 15px !important;
                page-break-inside: avoid !important;
            }
            
            .image-section {
                page-break-inside: avoid !important;
            }
            
            .content-section {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 15px !important;
                page-break-inside: avoid !important;
            }
            
            .section {
                page-break-inside: avoid !important;
            }
            
            .writing-area {
                min-height: 150px !important;
                page-break-inside: avoid !important;
            }
            
            .writing-textarea {
                min-height: 150px !important;
                border: none !important;
                resize: none !important;
            }
            
            .mode-switcher {
                display: none !important;
            }
            
            .drawing-tools {
                display: none !important;
            }
            
            .camera-controls {
                display: none !important;
            }
            
            #cameraPreview {
                display: none !important;
            }
            
            .upload-placeholder {
                display: none !important;
            }
            
            .image-area {
                border-style: solid !important;
                height: 250px !important;
            }
            
            #drawingCanvas {
                height: 250px !important;
            }
            
            .footer {
                page-break-inside: avoid !important;
            }
            
            .footer .tip {
                display: none !important;
            }
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .worksheet {
                width: 100%;
                max-width: 1100px;
            }
        }
        
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .image-section {
                order: -1;
                margin-bottom: 20px;
            }
            
            .content-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .writing-textarea {
                min-height: 150px;
            }
            
            .mode-switcher {
                flex-direction: column;
                gap: 8px;
            }
            
            .mode-btn {
                width: 100%;
                padding: 10px;
            }
        }
        
        @media (min-width: 768px) and (max-width: 1024px) {
            .mode-switcher {
                flex-direction: row;
                flex-wrap: nowrap;
            }
            
            .mode-btn {
                flex: 1;
                font-size: 13px;
                padding: 8px 10px;
            }
            
            /* 768pxì—ì„œ 1024px ì‚¬ì´ì—ì„œëŠ” ì§§ì€ í…ìŠ¤íŠ¸ ì‚¬ìš© */
            .btn-text-full {
                display: none;
            }
            .btn-text-short {
                display: inline;
            }
        }
        
        @media (min-width: 360px) and (max-width: 480px) {
            .mode-switcher {
                flex-direction: row;
                gap: 8px;
            }
            
            .mode-btn {
                flex: 1;
                padding: 8px 10px;
            }
        }
        
        @media (min-width: 481px) and (max-width: 767px) {
            .mode-switcher {
                flex-direction: row;
                gap: 5px;
            }
            
            .mode-btn {
                flex: 1;
                padding: 8px 6px;
                font-size: 12px;
                min-width: auto;
            }
            
            .btn-text-full {
                display: none;
            }
            
            .btn-text-short {
                display: inline;
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .worksheet {
                padding: 15px;
            }
            
            .main-container {
                gap: 15px;
            }
            
            .image-section {
                padding: 12px;
                min-width: auto;
            }
            
            .image-area {
                height: 250px;
            }
            
            .mode-switcher {
                flex-direction: column;
            }
            
            .mode-btn {
                width: 100%;
                padding: 10px;
                font-size: 14px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            .section-icon {
                font-size: 32px;
            }
            
            .image-title {
                font-size: 16px;
            }
        }
        
        /* ë§¤ìš° ì‘ì€ í™”ë©´ (360px ì´í•˜) */
        @media (max-width: 360px) {
            .worksheet {
                padding: 10px;
            }
            
            .header {
                margin-bottom: 10px;
            }
            
            .title {
                font-size: 16px;
                padding: 8px;
            }
            
            .student-info {
                font-size: 13px;
            }
            
            .image-section {
                padding: 10px;
            }
            
            .image-title {
                font-size: 15px;
            }
            
            .mode-switcher {
                gap: 5px;
            }
            
            .mode-btn {
                font-size: 12px;
                padding: 8px;
                min-width: 50px;
            }
            
            .section {
                padding: 10px;
            }
            
            .section-icon {
                font-size: 28px;
                margin-bottom: 5px;
            }
            
            .section-title {
                font-size: 15px;
                margin-bottom: 5px;
            }
            
            .section-question {
                font-size: 12px;
            }
            
            .section-question-ko {
                font-size: 12px;
                margin-bottom: 10px;
            }
            
            .writing-textarea {
                font-size: 13px;
                min-height: 120px;
            }
            
            .writing-textarea::placeholder {
                font-size: 12px;
            }
            
            .btn {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            /* ê·¸ë¦¬ê¸° ë„êµ¬ ë°˜ì‘í˜• */
            .drawing-tools {
                padding: 8px;
            }
            
            .color-palette {
                gap: 5px;
            }
            
            .color-btn {
                width: 25px;
                height: 25px;
            }
            
            .tool-controls {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .brush-size {
                font-size: 12px;
            }
            
            .size-btn.small { width: 10px; height: 10px; }
            .size-btn.medium { width: 14px; height: 14px; }
            .size-btn.large { width: 18px; height: 18px; }
            
            .tool-btn {
                font-size: 12px;
                padding: 4px 8px;
            }
            
            /* ì—…ë¡œë“œ í”Œë ˆì´ìŠ¤í™€ë” */
            .upload-placeholder p {
                font-size: 12px;
            }
            
            .upload-icon {
                font-size: 36px;
            }
            
            /* íŒ ìˆ¨ê¸°ê¸° */
            .footer .tip {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="controls">
    <button class="btn" onclick="printWorksheet()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
    <button class="btn image" id="imageBtn" onclick="downloadImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
    <button class="btn download" id="templateBtn" onclick="downloadTemplate()">ğŸ“„ í•™ìŠµì§€ í…œí”Œë¦¿ (PDF)</button>
    <button class="btn reset" onclick="clearAllData()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
</div>

<div class="worksheet" id="worksheet">
    <div class="header">
        <div class="title">See Think Wonder</div>
    </div>
    
    <div class="student-info">
        <div class="info-field">
            <label for="classInput">í•™ë°˜:</label>
            <input type="text" id="classInput" class="info-input">
        </div>
        <div class="info-field">
            <label for="numberInput">ë²ˆí˜¸:</label>
            <input type="text" id="numberInput" class="info-input">
        </div>
        <div class="info-field">
            <label for="nameInput">ì´ë¦„:</label>
            <input type="text" id="nameInput" class="info-input">
        </div>
    </div>
    
    <div class="main-container">
        <div class="image-section">
            <div class="image-header">
                <div class="image-title">
                    <span class="title-full">ğŸ“¸ ê´€ì°° ëŒ€ìƒ</span>
                    <span class="title-short">ğŸ“¸ ëŒ€ìƒ</span>
                </div>
                <div class="mode-switcher">
                    <button class="mode-btn active" onclick="switchMode('upload')">
                        <span class="btn-icon">ğŸ“¤</span>
                        <span class="btn-text-full">ì‚¬ì§„ ì—…ë¡œë“œ</span>
                        <span class="btn-text-short">ì—…ë¡œë“œ</span>
                    </button>
                    <button class="mode-btn" onclick="switchMode('draw')">
                        <span class="btn-icon">âœï¸</span>
                        <span class="btn-text-full">ê·¸ë¦¼ ê·¸ë¦¬ê¸°</span>
                        <span class="btn-text-short">ê·¸ë¦¬ê¸°</span>
                    </button>
                    <button class="mode-btn" onclick="switchMode('camera')">
                        <span class="btn-icon">ğŸ“·</span>
                        <span class="btn-text-full">ì‚¬ì§„ ì´¬ì˜</span>
                        <span class="btn-text-short">ì´¬ì˜</span>
                    </button>
                </div>
            </div>
            
            <div class="image-area" id="imageArea">
                <div class="upload-placeholder" id="uploadPlaceholder">
                    <div class="upload-icon">ğŸ“·</div>
                    <p>ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë†“ìœ¼ì„¸ìš”</p>
                    <p>ë˜ëŠ” <button class="tool-btn" onclick="document.getElementById('fileInput').click()">íŒŒì¼ ì„ íƒ</button></p>
                </div>
                <canvas id="drawingCanvas" style="width: 100%; height: 100%;"></canvas>
                <video id="cameraPreview" style="display: none; width: 100%; height: 100%; object-fit: cover;"></video>
                <img id="uploadedImage" class="uploaded-image" style="display: none;">
            </div>
            
            <div class="drawing-tools" id="drawingTools">
                <div class="color-palette">
                    <div class="color-btn active" style="background: black" onclick="setColor('black')"></div>
                    <div class="color-btn" style="background: #2563eb" onclick="setColor('#2563eb')"></div>
                    <div class="color-btn" style="background: #dc2626" onclick="setColor('#dc2626')"></div>
                    <div class="color-btn" style="background: #16a34a" onclick="setColor('#16a34a')"></div>
                    <div class="color-btn" style="background: #facc15" onclick="setColor('#facc15')"></div>
                </div>
                <div class="tool-controls">
                    <div class="brush-size">
                        <span style="font-size: 14px;">êµµê¸°:</span>
                        <div class="size-btn small" onclick="setBrushSize(2)"></div>
                        <div class="size-btn medium active" onclick="setBrushSize(5)"></div>
                        <div class="size-btn large" onclick="setBrushSize(10)"></div>
                    </div>
                    <button class="tool-btn" onclick="toggleEraser()">ì§€ìš°ê°œ</button>
                    <button class="tool-btn" onclick="clearCanvas()">ì „ì²´ ì§€ìš°ê¸°</button>
                </div>
            </div>
            
            <div class="camera-controls" id="cameraControls" style="display: none;">
                <button class="tool-btn" onclick="startCamera()" id="startCameraBtn">ğŸ“· ì¹´ë©”ë¼ ì‹œì‘</button>
                <button class="tool-btn" onclick="capturePhoto()" id="captureBtn" style="display: none; background: #dc2626; color: white;">ğŸ“¸ ì´¬ì˜</button>
                <button class="tool-btn" onclick="switchCamera()" id="switchCameraBtn" style="display: none;">ğŸ”„ ì¹´ë©”ë¼ ì „í™˜</button>
                <button class="tool-btn" onclick="retakePhoto()" id="retakeBtn" style="display: none;">ë‹¤ì‹œ ì°ê¸°</button>
            </div>
            
            <input type="text" class="caption-input" placeholder="ì œëª© ë˜ëŠ” ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" tabindex="4">
            <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
        </div>
        
        <div class="content-section">
            <div class="section see">
                <div class="section-header">
                    <span class="section-icon">ğŸ‘€</span>
                    <div class="section-title">SEE</div>
                    <div class="section-question">What do you see?</div>
                    <div class="section-question-ko">ë¬´ì—‡ì´ ë³´ì´ë‚˜ìš”?</div>
                </div>
                <div class="writing-area">
                    <textarea class="writing-textarea" placeholder="ë¬´ì—‡ì´ ë³´ì´ë‚˜ìš”? ê´€ì°°í•œ ë‚´ìš©ì„ ìì„¸íˆ ì ì–´ë³´ì„¸ìš”..." tabindex="1"></textarea>
                </div>
            </div>
            
            <div class="section think">
                <div class="section-header">
                    <span class="section-icon">ğŸ¤”</span>
                    <div class="section-title">THINK</div>
                    <div class="section-question">What do you think is going on?</div>
                    <div class="section-question-ko">ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?</div>
                </div>
                <div class="writing-area">
                    <textarea class="writing-textarea" placeholder="ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‹¤ê³  ìƒê°í•˜ë‚˜ìš”? ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”..." tabindex="2"></textarea>
                </div>
            </div>
            
            <div class="section wonder">
                <div class="section-header">
                    <span class="section-icon">â“</span>
                    <div class="section-title">WONDER</div>
                    <div class="section-question">What does it make you wonder?</div>
                    <div class="section-question-ko">ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš”?</div>
                </div>
                <div class="writing-area">
                    <textarea class="writing-textarea" placeholder="ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš”? ë” ì•Œê³  ì‹¶ì€ ì ì„ ì ì–´ë³´ì„¸ìš”..." tabindex="3"></textarea>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        í•˜ë²„ë“œ í”„ë¡œì íŠ¸ ì œë¡œ(Project Zero) - Visible Thinking ì‚¬ê³  ë£¨í‹´
        <div class="tip">ğŸ’¡ Tip: Ctrl+Enterë¡œ ë‹¤ìŒ ì¹¸ìœ¼ë¡œ ì´ë™ | ì‘ì„± ë‚´ìš©ì€ ìë™ ì €ì¥ë©ë‹ˆë‹¤</div>
    </div>
</div>

<div class="template-worksheet" id="templateWorksheet">
    <div class="template-header">
        <div class="template-title">See Think Wonder</div>
    </div>
    
    <div class="template-student-info">
        <div class="template-info-field">
            <label>í•™ë°˜:</label><span class="blank"></span>
        </div>
        <div class="template-info-field">
            <label>ë²ˆí˜¸:</label><span class="blank"></span>
        </div>
        <div class="template-info-field">
            <label>ì´ë¦„:</label><span class="blank"></span>
        </div>
    </div>
    
    <div class="template-content">
        <div class="template-section see">
            <div class="template-section-header">
                <div class="template-section-icon">ğŸ‘€</div>
                <div class="template-section-title">SEE</div>
                <div class="template-section-question">What do you see?</div>
                <div class="template-section-question-ko">ë¬´ì—‡ì´ ë³´ì´ë‚˜ìš”?</div>
            </div>
            <div class="template-writing-area"></div>
        </div>
        
        <div class="template-section think">
            <div class="template-section-header">
                <div class="template-section-icon">ğŸ¤”</div>
                <div class="template-section-title">THINK</div>
                <div class="template-section-question">What do you think is going on?</div>
                <div class="template-section-question-ko">ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?</div>
            </div>
            <div class="template-writing-area"></div>
        </div>
        
        <div class="template-section wonder">
            <div class="template-section-header">
                <div class="template-section-icon">â“</div>
                <div class="template-section-title">WONDER</div>
                <div class="template-section-question">What does it make you wonder?</div>
                <div class="template-section-question-ko">ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš”?</div>
            </div>
            <div class="template-writing-area"></div>
        </div>
    </div>
    
    <div class="template-footer">
        í•˜ë²„ë“œ í”„ë¡œì íŠ¸ ì œë¡œ(Project Zero) - Visible Thinking ì‚¬ê³  ë£¨í‹´
    </div>
</div>

<script>
// ì „ì—­ ë³€ìˆ˜
let currentMode = 'upload';
let canvas = null;
let ctx = null;
let isDrawing = false;
let currentColor = 'black';
let currentSize = 5;
let isEraser = false;
let stream = null; // ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼
let capturedPhotoData = null; // ì´¬ì˜ëœ ì‚¬ì§„ ë°ì´í„°
let facingMode = 'environment'; // ì¹´ë©”ë¼ ë°©í–¥ (environment: í›„ë©´, user: ì „ë©´)

// ì´ˆê¸°í™”
window.onload = function() {
    canvas = document.getElementById('drawingCanvas');
    ctx = canvas.getContext('2d');
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    
    setupCanvasEvents();
    setupDragDrop();
    setupInputs(); // í•¨ìˆ˜ ì´ë¦„ ë³€ê²½: setupTextareas -> setupInputs
    
    // ìº”ë²„ìŠ¤ ì´ˆê¸° í¬ê¸° ì„¤ì •
    setTimeout(() => {
        resizeCanvas();
    }, 100);
    
    // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìº”ë²„ìŠ¤ í¬ê¸° ì¬ì¡°ì •
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            if (currentMode === 'draw') {
                resizeCanvas();
            }
        }, 250);
    });
};

// ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • í•¨ìˆ˜
function resizeCanvas() {
    const imageArea = document.getElementById('imageArea');
    if (imageArea && canvas) {
        // ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
        const width = imageArea.offsetWidth - 4;
        const height = imageArea.offsetHeight - 4;
        
        // ìº”ë²„ìŠ¤ ì‹¤ì œ í¬ê¸° ì„¤ì •
        canvas.width = width;
        canvas.height = height;
        
        // ìŠ¤íƒ€ì¼ í¬ê¸°ë„ ë™ì¼í•˜ê²Œ ì„¤ì •
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
    }
}

// ì…ë ¥ í•„ë“œ ì„¤ì • í•¨ìˆ˜
function setupInputs() {
    // í•™ìƒ ì •ë³´ ì…ë ¥ í•„ë“œ
    const infoInputs = document.querySelectorAll('.info-input');
    infoInputs.forEach(input => {
        input.addEventListener('input', saveFormData);
    });

    // See, Think, Wonder í…ìŠ¤íŠ¸ ì˜ì—­
    const textareas = document.querySelectorAll('.writing-textarea');
    textareas.forEach((textarea, index) => {
        // ì…ë ¥ ì‹œ ë†’ì´ ìë™ ì¡°ì • ë° ìë™ ì €ì¥
        textarea.addEventListener('input', function() {
            autoResizeTextarea(this);
            saveFormData();
        });
        
        // Ctrl+Enterë¡œ ë‹¤ìŒ í…ìŠ¤íŠ¸ ì˜ì—­ìœ¼ë¡œ ì´ë™
        textarea.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                const nextIndex = index + 1;
                if (nextIndex < textareas.length) {
                    textareas[nextIndex].focus();
                } else {
                    // ë§ˆì§€ë§‰ textareaì—ì„œëŠ” ìº¡ì…˜ ì…ë ¥ë€ìœ¼ë¡œ ì´ë™
                    document.querySelector('.caption-input').focus();
                }
            }
        });
        
        // ì´ˆê¸° ë†’ì´ ì„¤ì •
        autoResizeTextarea(textarea);
    });
    
    // ìº¡ì…˜ ì…ë ¥ë€ë„ ìë™ ì €ì¥
    const captionInput = document.querySelector('.caption-input');
    if (captionInput) {
        captionInput.addEventListener('input', saveFormData);
    }
    
    // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    loadFormData();
}

// í¼ ë°ì´í„° ì €ì¥
function saveFormData() {
    const formData = {
        class: document.getElementById('classInput').value,
        number: document.getElementById('numberInput').value,
        name: document.getElementById('nameInput').value,
        see: document.querySelectorAll('.writing-textarea')[0].value,
        think: document.querySelectorAll('.writing-textarea')[1].value,
        wonder: document.querySelectorAll('.writing-textarea')[2].value,
        caption: document.querySelector('.caption-input').value
    };
    localStorage.setItem('seeThinkWonderData', JSON.stringify(formData));
}

// í¼ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
function loadFormData() {
    const savedData = localStorage.getItem('seeThinkWonderData');
    if (savedData) {
        const formData = JSON.parse(savedData);
        const textareas = document.querySelectorAll('.writing-textarea');
        
        if (formData.class) document.getElementById('classInput').value = formData.class;
        if (formData.number) document.getElementById('numberInput').value = formData.number;
        if (formData.name) document.getElementById('nameInput').value = formData.name;

        if (formData.see) textareas[0].value = formData.see;
        if (formData.think) textareas[1].value = formData.think;
        if (formData.wonder) textareas[2].value = formData.wonder;
        if (formData.caption) document.querySelector('.caption-input').value = formData.caption;
        
        // ë†’ì´ ì¬ì¡°ì •
        textareas.forEach(textarea => autoResizeTextarea(textarea));
    }
}

// Textarea ë†’ì´ ìë™ ì¡°ì •
function autoResizeTextarea(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = Math.max(180, textarea.scrollHeight) + 'px';
}

// ëª¨ë“œ ì „í™˜
function switchMode(mode) {
    currentMode = mode;
    const modeBtns = document.querySelectorAll('.mode-btn');
    const clickedBtn = event.currentTarget; // Use currentTarget to ensure it's the button
    
    modeBtns.forEach(btn => btn.classList.remove('active'));
    if (clickedBtn) {
       clickedBtn.classList.add('active');
    }
    
    const uploadPlaceholder = document.getElementById('uploadPlaceholder');
    const uploadedImage = document.getElementById('uploadedImage');
    const drawingCanvas = document.getElementById('drawingCanvas');
    const drawingTools = document.getElementById('drawingTools');
    const cameraPreview = document.getElementById('cameraPreview');
    const cameraControls = document.getElementById('cameraControls');
    
    // ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì •ì§€
    if (stream && mode !== 'camera') {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
    }
    
    if (mode === 'upload') {
        uploadPlaceholder.style.display = uploadedImage.style.display === 'none' ? 'block' : 'none';
        drawingCanvas.style.display = 'none';
        drawingTools.style.display = 'none';
        cameraPreview.style.display = 'none';
        cameraControls.style.display = 'none';
    } else if (mode === 'draw') {
        uploadPlaceholder.style.display = 'none';
        uploadedImage.style.display = 'none';
        drawingCanvas.style.display = 'block';
        drawingTools.style.display = 'block';
        cameraPreview.style.display = 'none';
        cameraControls.style.display = 'none';
        
        // ê·¸ë¦¬ê¸° ëª¨ë“œë¡œ ì „í™˜ ì‹œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
        setTimeout(() => {
            resizeCanvas();
            // ctx ì¬ì„¤ì •
            ctx = canvas.getContext('2d');
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }, 100);
    } else if (mode === 'camera') {
        uploadPlaceholder.style.display = 'none';
        uploadedImage.style.display = 'none';
        drawingCanvas.style.display = 'none';
        drawingTools.style.display = 'none';
        cameraPreview.style.display = 'block';
        cameraControls.style.display = 'block';
        
        // ì´¬ì˜ëœ ì‚¬ì§„ì´ ìˆìœ¼ë©´ í‘œì‹œ
        if (capturedPhotoData) {
            showCapturedPhoto();
        }
    }
}

// ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
function setupDragDrop() {
    const imageArea = document.getElementById('imageArea');
    
    imageArea.addEventListener('dragover', (e) => {
        if (currentMode === 'upload') {
            e.preventDefault();
            imageArea.classList.add('dragover');
        }
    });
    
    imageArea.addEventListener('dragleave', () => {
        imageArea.classList.remove('dragover');
    });
    
    imageArea.addEventListener('drop', (e) => {
        if (currentMode === 'upload') {
            e.preventDefault();
            imageArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                handleImageUpload(files[0]);
            }
        }
    });
}

// ì¹´ë©”ë¼ ì‹œì‘
async function startCamera() {
    try {
        const video = document.getElementById('cameraPreview');
        const startBtn = document.getElementById('startCameraBtn');
        const captureBtn = document.getElementById('captureBtn');
        const switchBtn = document.getElementById('switchCameraBtn');
        const retakeBtn = document.getElementById('retakeBtn');
        
        // ê¸°ì¡´ ìŠ¤íŠ¸ë¦¼ì´ ìˆìœ¼ë©´ ì •ì§€
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        
        // ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­
        stream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: facingMode
            } 
        });
        
        video.srcObject = stream;
        video.play();
        
        // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        startBtn.style.display = 'none';
        captureBtn.style.display = 'inline-block';
        
        // ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œë§Œ ì¹´ë©”ë¼ ì „í™˜ ë²„íŠ¼ í‘œì‹œ
        if (navigator.mediaDevices.getSupportedConstraints().facingMode) {
            switchBtn.style.display = 'inline-block';
        }
        
        retakeBtn.style.display = 'none';
        
        capturedPhotoData = null;
    } catch (error) {
        console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜:', error);
        alert('ì¹´ë©”ë¼ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆê±°ë‚˜ ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
}

// ì¹´ë©”ë¼ ì „í™˜
async function switchCamera() {
    facingMode = facingMode === 'environment' ? 'user' : 'environment';
    await startCamera();
}

// ì‚¬ì§„ ì´¬ì˜
function capturePhoto() {
    const video = document.getElementById('cameraPreview');
    const imageArea = document.getElementById('imageArea');
    const captureBtn = document.getElementById('captureBtn');
    const switchBtn = document.getElementById('switchCameraBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    
    // ì„ì‹œ ìº”ë²„ìŠ¤ ìƒì„±
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = video.videoWidth;
    tempCanvas.height = video.videoHeight;
    const tempCtx = tempCanvas.getContext('2d');
    
    // ë¹„ë””ì˜¤ í”„ë ˆì„ì„ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
    tempCtx.drawImage(video, 0, 0);
    
    // ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥
    capturedPhotoData = tempCanvas.toDataURL('image/png');
    
    // ì´¬ì˜ëœ ì‚¬ì§„ í‘œì‹œ
    showCapturedPhoto();
    
    // ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì •ì§€
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
    }
    
    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
    captureBtn.style.display = 'none';
    switchBtn.style.display = 'none';
    retakeBtn.style.display = 'inline-block';
}

// ì´¬ì˜ëœ ì‚¬ì§„ í‘œì‹œ
function showCapturedPhoto() {
    const imageArea = document.getElementById('imageArea');
    const cameraPreview = document.getElementById('cameraPreview');
    
    // ê¸°ì¡´ ì´¬ì˜ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì œê±°
    const existingPhoto = imageArea.querySelector('.captured-photo');
    if (existingPhoto) {
        existingPhoto.remove();
    }
    
    // ì´¬ì˜ëœ ì‚¬ì§„ í‘œì‹œ
    const img = document.createElement('img');
    img.src = capturedPhotoData;
    img.className = 'captured-photo';
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'contain';
    img.style.position = 'absolute';
    img.style.top = '0';
    img.style.left = '0';
    
    imageArea.appendChild(img);
    cameraPreview.style.display = 'none';
}

// ë‹¤ì‹œ ì°ê¸°
function retakePhoto() {
    const cameraPreview = document.getElementById('cameraPreview');
    const retakeBtn = document.getElementById('retakeBtn');
    
    // ì´¬ì˜ëœ ì‚¬ì§„ ì œê±°
    capturedPhotoData = null;
    
    // ì´¬ì˜ëœ ì´ë¯¸ì§€ ìš”ì†Œê°€ ìˆìœ¼ë©´ ì œê±°
    const capturedImg = document.querySelector('.captured-photo');
    if (capturedImg) {
        capturedImg.remove();
    }
    
    // ì¹´ë©”ë¼ í”„ë¦¬ë·° ë‹¤ì‹œ í‘œì‹œ
    cameraPreview.style.display = 'block';
    
    // ë²„íŠ¼ ìˆ¨ê¸°ê¸° (startCameraì—ì„œ ë‹¤ì‹œ ì„¤ì •ë¨)
    retakeBtn.style.display = 'none';
    
    // ì¹´ë©”ë¼ ë‹¤ì‹œ ì‹œì‘
    startCamera();
}

// í˜ì´ì§€ ì¢…ë£Œ ì‹œ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì •ì§€
window.addEventListener('beforeunload', () => {
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
    }
});

// ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
function clearAllData() {
    if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        // í•™ìƒ ì •ë³´ ì´ˆê¸°í™”
        document.querySelectorAll('.info-input').forEach(input => input.value = '');

        // textarea ì´ˆê¸°í™”
        document.querySelectorAll('.writing-textarea').forEach(textarea => {
            textarea.value = '';
            autoResizeTextarea(textarea);
        });
        
        // ìº¡ì…˜ ì´ˆê¸°í™”
        document.querySelector('.caption-input').value = '';
        
        // ì´ë¯¸ì§€ ì´ˆê¸°í™”
        document.getElementById('uploadedImage').src = '';
        document.getElementById('uploadedImage').style.display = 'none';
        document.getElementById('uploadPlaceholder').style.display = 'block';
        
        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        if (ctx) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        // ì¹´ë©”ë¼ ëª¨ë“œ ì´ˆê¸°í™”
        capturedPhotoData = null;
        const capturedPhoto = document.querySelector('.captured-photo');
        if (capturedPhoto) {
            capturedPhoto.remove();
        }
        
        // ì €ì¥ëœ ë°ì´í„° ì‚­ì œ
        localStorage.removeItem('seeThinkWonderData');
        
        // ì²« ë²ˆì§¸ ëª¨ë“œë¡œ ì „í™˜
        const firstModeBtn = document.querySelector('.mode-btn');
        if (firstModeBtn) {
            firstModeBtn.click();
        }
        
        alert('ëª¨ë“  ë‚´ìš©ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
}

// íŒŒì¼ ì„ íƒ ì²˜ë¦¬
function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
        handleImageUpload(file);
    }
}

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
function handleImageUpload(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const uploadedImage = document.getElementById('uploadedImage');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        
        uploadedImage.src = e.target.result;
        uploadedImage.style.display = 'block';
        uploadPlaceholder.style.display = 'none';
    };
    reader.readAsDataURL(file);
}

// ìº”ë²„ìŠ¤ ì´ë²¤íŠ¸ ì„¤ì •
function setupCanvasEvents() {
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    // í„°ì¹˜ ì´ë²¤íŠ¸ ì§€ì›
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const mouseEvent = new MouseEvent('mousedown', {
            clientX: touch.clientX,
            clientY: touch.clientY
        });
        canvas.dispatchEvent(mouseEvent);
    });
    
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent('mousemove', {
            clientX: touch.clientX,
            clientY: touch.clientY
        });
        canvas.dispatchEvent(mouseEvent);
    });
    
    canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        const mouseEvent = new MouseEvent('mouseup', {});
        canvas.dispatchEvent(mouseEvent);
    });
}

// ê·¸ë¦¬ê¸° ì‹œì‘
function startDrawing(e) {
    isDrawing = true;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    ctx.beginPath();
    ctx.moveTo(x, y);
}

// ê·¸ë¦¬ê¸°
function draw(e) {
    if (!isDrawing) return;
    
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    ctx.globalCompositeOperation = isEraser ? 'destination-out' : 'source-over';
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = currentSize;
    
    ctx.lineTo(x, y);
    ctx.stroke();
}

// ê·¸ë¦¬ê¸° ì¢…ë£Œ
function stopDrawing() {
    isDrawing = false;
}

// ìƒ‰ìƒ ì„¤ì •
function setColor(color) {
    currentColor = color;
    isEraser = false;
    const clickedBtn = event.currentTarget;
    
    document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
    if (clickedBtn) {
       clickedBtn.classList.add('active');
    }
}

// ë¸ŒëŸ¬ì‹œ í¬ê¸° ì„¤ì •
function setBrushSize(size) {
    currentSize = size;
    const clickedBtn = event.currentTarget;
    
    document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
    if (clickedBtn) {
        clickedBtn.classList.add('active');
    }
}

// ì§€ìš°ê°œ í† ê¸€
function toggleEraser() {
    isEraser = !isEraser;
    const clickedBtn = event.currentTarget;
    if (clickedBtn) {
        clickedBtn.textContent = isEraser ? 'íœ' : 'ì§€ìš°ê°œ';
    }
    
    if (isEraser) {
        document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
    }
}

// ìº”ë²„ìŠ¤ ì „ì²´ ì§€ìš°ê¸°
function clearCanvas() {
    if (confirm('ê·¸ë¦¼ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
}

// ì¸ì‡„ ê¸°ëŠ¥
function printWorksheet() {
    // ì¸ì‡„ ì „ ìŠ¤íƒ€ì¼ ì ìš©
    const style = document.createElement('style');
    style.textContent = `
        @media print {
            @page {
                size: A4 landscape !important;
                margin: 10mm !important;
            }
        }
    `;
    document.head.appendChild(style);
    
    // ì¸ì‡„ ì‹¤í–‰
    window.print();
    
    // ì¸ì‡„ í›„ ìŠ¤íƒ€ì¼ ì œê±°
    setTimeout(() => {
        document.head.removeChild(style);
    }, 100);
}

// í•™ìŠµì§€ í…œí”Œë¦¿ PDF ë‹¤ìš´ë¡œë“œ
function downloadTemplate() {
    // ë²„íŠ¼ ë¹„í™œì„±í™”
    const templateBtn = document.getElementById('templateBtn');
    const originalText = templateBtn.textContent;
    templateBtn.disabled = true;
    templateBtn.textContent = 'â³ í…œí”Œë¦¿ ìƒì„± ì¤‘...';
    
    // í…œí”Œë¦¿ ì›Œí¬ì‹œíŠ¸ ìš”ì†Œ
    const templateWorksheet = document.getElementById('templateWorksheet');
    
    // í…œí”Œë¦¿ í‘œì‹œ
    templateWorksheet.style.display = 'block';
    
    const opt = {
        margin: 0,
        filename: 'See-Think-Wonder_í…œí”Œë¦¿.pdf',
        image: { 
            type: 'jpeg', 
            quality: 0.98 
        },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            logging: false,
            letterRendering: true,
            backgroundColor: '#ffffff',
            width: 1122, // A4 landscape in pixels at 96 DPI
            height: 794
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'landscape' 
        }
    };
    
    // PDF ìƒì„±
    html2pdf().set(opt).from(templateWorksheet).save()
        .then(() => {
            // í…œí”Œë¦¿ ìˆ¨ê¸°ê¸°
            templateWorksheet.style.display = 'none';
            
            // ë²„íŠ¼ ë³µì›
            templateBtn.disabled = false;
            templateBtn.textContent = originalText;
        })
        .catch((error) => {
            console.error('í…œí”Œë¦¿ ìƒì„± ì˜¤ë¥˜:', error);
            alert('í…œí”Œë¦¿ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            
            // í…œí”Œë¦¿ ìˆ¨ê¸°ê¸°
            templateWorksheet.style.display = 'none';
            
            // ë²„íŠ¼ ë³µì›
            templateBtn.disabled = false;
            templateBtn.textContent = originalText;
        });
}

// ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
function downloadImage() {
    // ë²„íŠ¼ ë¹„í™œì„±í™”
    const imageBtn = document.getElementById('imageBtn');
    const originalText = imageBtn.textContent;
    imageBtn.disabled = true;
    imageBtn.textContent = 'â³ ì´ë¯¸ì§€ ìƒì„± ì¤‘...';
    
    const element = document.getElementById('worksheet');
    
    // í˜„ì¬ ëª¨ë“œê°€ ê·¸ë¦¬ê¸° ëª¨ë“œì¸ ê²½ìš° ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
    let canvasDataUrl = null;
    if (currentMode === 'draw') {
        const canvas = document.getElementById('drawingCanvas');
        canvasDataUrl = canvas.toDataURL('image/png');
    }
    
    // html2canvas ì˜µì…˜
    const options = {
        scale: 2, // ê³ í•´ìƒë„
        useCORS: true,
        logging: false,
        letterRendering: true,
        allowTaint: true,
        backgroundColor: '#ffffff',
        onclone: function(clonedDoc) {
            // ë³µì œëœ ë¬¸ì„œì—ì„œ ìŠ¤íƒ€ì¼ ì¡°ì •
            const clonedElement = clonedDoc.getElementById('worksheet');
            clonedElement.style.width = '1050px';
            clonedElement.style.maxWidth = 'none';
            clonedElement.style.margin = '0';
            clonedElement.style.boxShadow = 'none';
            clonedElement.style.padding = '30px';
            
            // ë©”ì¸ ì»¨í…Œì´ë„ˆ ì¡°ì •
            const mainContainer = clonedDoc.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.display = 'grid';
                mainContainer.style.gridTemplateColumns = '280px 1fr';
                mainContainer.style.gap = '20px';
            }
            
            // ì½˜í…ì¸  ì„¹ì…˜ ì¡°ì •
            const contentSection = clonedDoc.querySelector('.content-section');
            if (contentSection) {
                contentSection.style.display = 'grid';
                contentSection.style.gridTemplateColumns = 'repeat(3, 1fr)';
                contentSection.style.gap = '15px';
            }
            
            // ëª¨ë“œ ì „í™˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const modeSwitcher = clonedDoc.querySelector('.mode-switcher');
            if (modeSwitcher) modeSwitcher.style.display = 'none';
            
            // ê·¸ë¦¬ê¸° ë„êµ¬ ìˆ¨ê¸°ê¸°
            const drawingTools = clonedDoc.querySelector('.drawing-tools');
            if (drawingTools) drawingTools.style.display = 'none';
            
            // ì—…ë¡œë“œ í”Œë ˆì´ìŠ¤í™€ë” ìˆ¨ê¸°ê¸°
            const placeholder = clonedDoc.querySelector('.upload-placeholder');
            if (placeholder && (currentMode === 'draw' || clonedDoc.querySelector('#uploadedImage').style.display !== 'none')) {
                placeholder.style.display = 'none';
            }
            
            // ê·¸ë¦¬ê¸° ëª¨ë“œì¸ ê²½ìš° ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ êµì²´
            if (currentMode === 'draw' && canvasDataUrl) {
                const clonedCanvas = clonedDoc.getElementById('drawingCanvas');
                const img = clonedDoc.createElement('img');
                img.src = canvasDataUrl;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'contain';
                clonedCanvas.parentNode.replaceChild(img, clonedCanvas);
            }
            
            // ì¹´ë©”ë¼ ëª¨ë“œì¸ ê²½ìš° ì´¬ì˜ëœ ì‚¬ì§„ ì²˜ë¦¬
            if (currentMode === 'camera' && capturedPhotoData) {
                const imageArea = clonedDoc.getElementById('imageArea');
                imageArea.innerHTML = '';
                const img = clonedDoc.createElement('img');
                img.src = capturedPhotoData;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'contain';
                imageArea.appendChild(img);
            }
            
            // ì¹´ë©”ë¼ í”„ë¦¬ë·° ìˆ¨ê¸°ê¸°
            const cameraPreview = clonedDoc.getElementById('cameraPreview');
            if (cameraPreview) cameraPreview.style.display = 'none';
            
            // ì¹´ë©”ë¼ ì»¨íŠ¸ë¡¤ ìˆ¨ê¸°ê¸°
            const cameraControls = clonedDoc.getElementById('cameraControls');
            if (cameraControls) cameraControls.style.display = 'none';
            
            // textarea ìŠ¤íƒ€ì¼ ì¡°ì • (ì´ë¯¸ì§€ìš©)
            const textareas = clonedDoc.querySelectorAll('.writing-textarea');
            textareas.forEach(textarea => {
                textarea.style.border = 'none';
                textarea.style.resize = 'none';
                textarea.style.overflow = 'hidden';
                // textarea ë†’ì´ë¥¼ ë‚´ìš©ì— ë§ê²Œ ìë™ ì¡°ì •
                if (textarea.value) {
                    textarea.style.height = 'auto';
                    textarea.style.height = textarea.scrollHeight + 'px';
                }
            });
        }
    };
    
    // html2canvasë¡œ ì´ë¯¸ì§€ ìƒì„±
    html2canvas(element, options).then(canvas => {
        // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        const link = document.createElement('a');
        link.download = 'See-Think-Wonder_í•™ìŠµì§€.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        // ë²„íŠ¼ ë³µì›
        imageBtn.disabled = false;
        imageBtn.textContent = originalText;
    }).catch(error => {
        console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
        alert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        // ë²„íŠ¼ ë³µì›
        imageBtn.disabled = false;
        imageBtn.textContent = originalText;
    });
}
</script>

</body>
</html>
